<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How to test Parsec - The Parsec Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../getting_started/index.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../getting_started/linux_x86.html"><strong aria-hidden="true">3.1.</strong> Quickstart for Linux on x86</a></li><li class="chapter-item expanded "><a href="../../getting_started/opensuse.html"><strong aria-hidden="true">3.2.</strong> Quickstart for openSUSE and SUSE</a></li><li class="chapter-item expanded "><a href="../../getting_started/docker.html"><strong aria-hidden="true">3.3.</strong> Quickstart using a Docker container</a></li><li class="chapter-item expanded "><a href="../../getting_started/installation_options.html"><strong aria-hidden="true">3.4.</strong> Installation Guide</a></li><li class="chapter-item expanded "><a href="../../getting_started/parsec_tool_use.html"><strong aria-hidden="true">3.5.</strong> Parsec Tool Guide</a></li></ol></li><li class="chapter-item expanded "><a href="../../parsec_users.html"><strong aria-hidden="true">4.</strong> Parsec for users</a></li><li class="chapter-item expanded "><a href="../../parsec_client/index.html"><strong aria-hidden="true">5.</strong> Parsec for client developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../parsec_client/api_overview.html"><strong aria-hidden="true">5.1.</strong> API Overview</a></li><li class="chapter-item expanded "><a href="../../parsec_client/wire_protocol.html"><strong aria-hidden="true">5.2.</strong> Wire Protocol</a></li><li class="chapter-item expanded "><a href="../../parsec_client/status_codes.html"><strong aria-hidden="true">5.3.</strong> Status Codes</a></li><li class="chapter-item expanded "><a href="../../parsec_client/writing_library.html"><strong aria-hidden="true">5.4.</strong> Writing a new Parsec Client Library</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/index.html"><strong aria-hidden="true">5.5.</strong> Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../parsec_client/operations/service_api_coverage.html"><strong aria-hidden="true">5.5.1.</strong> Parsec Operations Coverage</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_key_attributes.html"><strong aria-hidden="true">5.5.2.</strong> PSA Key Attributes</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_algorithm.html"><strong aria-hidden="true">5.5.3.</strong> PSA Algorithm</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/ping.html"><strong aria-hidden="true">5.5.4.</strong> Ping</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_generate_key.html"><strong aria-hidden="true">5.5.5.</strong> PsaGenerateKey</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_destroy_key.html"><strong aria-hidden="true">5.5.6.</strong> PsaDestroyKey</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_sign_hash.html"><strong aria-hidden="true">5.5.7.</strong> PsaSignHash</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_verify_hash.html"><strong aria-hidden="true">5.5.8.</strong> PsaVerifyHash</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_import_key.html"><strong aria-hidden="true">5.5.9.</strong> PsaImportKey</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_export_public_key.html"><strong aria-hidden="true">5.5.10.</strong> PsaExportPublicKey</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/list_providers.html"><strong aria-hidden="true">5.5.11.</strong> ListProviders</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/list_opcodes.html"><strong aria-hidden="true">5.5.12.</strong> ListOpcodes</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_asymmetric_encrypt.html"><strong aria-hidden="true">5.5.13.</strong> PsaAsymmetricEncrypt</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_asymmetric_decrypt.html"><strong aria-hidden="true">5.5.14.</strong> PsaAsymmetricDecrypt</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_export_key.html"><strong aria-hidden="true">5.5.15.</strong> PsaExportKey</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_generate_random.html"><strong aria-hidden="true">5.5.16.</strong> PsaGenerateRandom</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/list_authenticators.html"><strong aria-hidden="true">5.5.17.</strong> ListAuthenticators</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_hash_compute.html"><strong aria-hidden="true">5.5.18.</strong> PsaHashCompute</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_hash_compare.html"><strong aria-hidden="true">5.5.19.</strong> PsaHashCompare</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_aead_encrypt.html"><strong aria-hidden="true">5.5.20.</strong> PsaAeadEncrypt</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_aead_decrypt.html"><strong aria-hidden="true">5.5.21.</strong> PsaAeadDecrypt</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_raw_key_agreement.html"><strong aria-hidden="true">5.5.22.</strong> PsaRawKeyAgreement</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_cipher_encrypt.html"><strong aria-hidden="true">5.5.23.</strong> PsaCipherEncrypt</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_cipher_decrypt.html"><strong aria-hidden="true">5.5.24.</strong> PsaCipherDecrypt</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_mac_compute.html"><strong aria-hidden="true">5.5.25.</strong> PsaMacCompute</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_mac_verify.html"><strong aria-hidden="true">5.5.26.</strong> PsaMacVerify</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_sign_message.html"><strong aria-hidden="true">5.5.27.</strong> PsaSignMessage</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/psa_verify_message.html"><strong aria-hidden="true">5.5.28.</strong> PsaVerifyMessage</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/list_keys.html"><strong aria-hidden="true">5.5.29.</strong> ListKeys</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/list_clients.html"><strong aria-hidden="true">5.5.30.</strong> ListClients</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/delete_client.html"><strong aria-hidden="true">5.5.31.</strong> DeleteClient</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/prepare_key_attestation_params.html"><strong aria-hidden="true">5.5.32.</strong> Prepare Key Attestation Parameters</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/prepare_key_attestation.html"><strong aria-hidden="true">5.5.33.</strong> PrepareKeyAttestation</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/attest_key.html"><strong aria-hidden="true">5.5.34.</strong> AttestKey</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/attest_key_params.html"><strong aria-hidden="true">5.5.35.</strong> Attest Key Parameters</a></li><li class="chapter-item expanded "><a href="../../parsec_client/operations/can_do_crypto.html"><strong aria-hidden="true">5.5.36.</strong> CanDoCrypto</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../parsec_service/index.html"><strong aria-hidden="true">6.</strong> Parsec for service developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../parsec_service/interfaces_and_dataflow.html"><strong aria-hidden="true">6.1.</strong> Interfaces and Dataflow</a></li><li class="chapter-item expanded "><a href="../../parsec_service/source_code_structure.html"><strong aria-hidden="true">6.2.</strong> Source Code Structure</a></li><li class="chapter-item expanded "><a href="../../parsec_service/listeners.html"><strong aria-hidden="true">6.3.</strong> Listeners</a></li><li class="chapter-item expanded "><a href="../../parsec_service/authenticators.html"><strong aria-hidden="true">6.4.</strong> Authenticators</a></li><li class="chapter-item expanded "><a href="../../parsec_service/converters.html"><strong aria-hidden="true">6.5.</strong> Converters</a></li><li class="chapter-item expanded "><a href="../../parsec_service/providers.html"><strong aria-hidden="true">6.6.</strong> Providers</a></li><li class="chapter-item expanded "><a href="../../parsec_service/key_info_managers.html"><strong aria-hidden="true">6.7.</strong> Key Info Managers</a></li><li class="chapter-item expanded "><a href="../../parsec_service/adding_provider.html"><strong aria-hidden="true">6.8.</strong> Adding a new Parsec Provider</a></li><li class="chapter-item expanded "><a href="../../parsec_service/build_run.html"><strong aria-hidden="true">6.9.</strong> How to build and run Parsec</a></li><li class="chapter-item expanded "><a href="../../parsec_service/install_parsec_linux.html"><strong aria-hidden="true">6.10.</strong> How to securely install Parsec on Linux</a></li><li class="chapter-item expanded "><a href="../../parsec_service/configuration.html"><strong aria-hidden="true">6.11.</strong> Parsec Configuration</a></li><li class="chapter-item expanded "><a href="../../parsec_service/tests/index.html" class="active"><strong aria-hidden="true">6.12.</strong> How to test Parsec</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../parsec_service/tests/existing_tests.html"><strong aria-hidden="true">6.12.1.</strong> List of existing tests</a></li></ol></li><li class="chapter-item expanded "><a href="../../parsec_service/stability.html"><strong aria-hidden="true">6.13.</strong> Parsec Stability</a></li></ol></li><li class="chapter-item expanded "><a href="../../parsec_security/index.html"><strong aria-hidden="true">7.</strong> Parsec Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../parsec_security/parsec_threat_model/threat_model.html"><strong aria-hidden="true">7.1.</strong> Parsec Threat Model</a></li><li class="chapter-item expanded "><a href="../../parsec_security/secure_deployment.html"><strong aria-hidden="true">7.2.</strong> Recommendations for Secure Deployment</a></li><li class="chapter-item expanded "><a href="../../parsec_security/rust_client_threat_model/threat_model.html"><strong aria-hidden="true">7.3.</strong> Parsec Rust Client Threat Model</a></li></ol></li><li class="chapter-item expanded "><a href="../../contributing/index.html"><strong aria-hidden="true">8.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../contributing/pr_checklist.html"><strong aria-hidden="true">8.1.</strong> Pull request checklist</a></li><li class="chapter-item expanded "><a href="../../contributing/adding_new_operation_how_to.html"><strong aria-hidden="true">8.2.</strong> How to add operations to Parsec</a></li><li class="chapter-item expanded "><a href="../../contributing/package_management.html"><strong aria-hidden="true">8.3.</strong> Package management and versioning guide</a></li><li class="chapter-item expanded "><a href="../../contributing/release_process.html"><strong aria-hidden="true">8.4.</strong> The Parsec Release Process</a></li><li class="chapter-item expanded "><a href="../../contributing/release_checklist.html"><strong aria-hidden="true">8.5.</strong> The Parsec Release Checklist</a></li></ol></li><li class="chapter-item expanded "><a href="../../archive/index.html"><strong aria-hidden="true">9.</strong> Archive</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../archive/system_architecture.html"><strong aria-hidden="true">9.1.</strong> System Architecture</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Parsec Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="how-to-test-parsec"><a class="header" href="#how-to-test-parsec">How to test Parsec</a></h1>
<p>Parsec relies on a mix of unit, end-to-end, integration, stress and fuzz tests. Unit tests are
usually found in the same module as the code they verify. End-to-end and stress tests can be found
in the <code>e2e_tests</code> directory (along with the code framework required for running them), and come in
two flavours: single-provider and all-providers. Integration tests are found in the <code>tests</code>
directory and test the public module that the <code>parsec-service</code> crate exports.</p>
<p>Single-provider tests do a thorough verification of each individual provider, while all-providers
tests check that the common functionality is capable of supporting multiple providers at the same
time. Another subcategory of integration tests are persistance tests which check that key material
is persisted through service restarts.</p>
<p>The stress test simply constructs and sends random requests as fast as possible using a
multithreaded client. Valid requests are sent intermittently so as to check that the service is
still up and working correctly.</p>
<p>The <code>ci.sh</code> script executes all tests and is used on the CI.</p>
<p>Parsec's code style is enforced by <a href="https://github.com/rust-lang/rustfmt"><code>rustfmt</code></a> and
<a href="https://github.com/rust-lang/rust-clippy"><code>clippy</code></a>, which are needed for code formatting and
static lint checks respectively. A documentation style is also enforced by <code>cargo test --doc</code>.</p>
<p>You can see a (partial) code coverage figure <a href="https://app.codecov.io/gh/parallaxsecond/parsec">here</a></p>
<ul>
<li>partial because only a subset of the tests can be run with the code coverage instrumentation
enabled.</li>
</ul>
<h2 id="executing-tests-manually"><a class="header" href="#executing-tests-manually">Executing tests manually</a></h2>
<h3 id="static-tests"><a class="header" href="#static-tests">Static tests</a></h3>
<h4 id="checking-code-formatting"><a class="header" href="#checking-code-formatting">Checking code formatting</a></h4>
<pre><code>cargo fmt --all -- --check
</code></pre>
<h4 id="checking-lints"><a class="header" href="#checking-lints">Checking lints</a></h4>
<pre><code>cargo clippy --all-targets --all-features -- -D clippy::all -D clippy::cargo
</code></pre>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit tests</a></h3>
<h4 id="doc-tests"><a class="header" href="#doc-tests">Doc tests</a></h4>
<pre><code>cargo test --doc --all-features
</code></pre>
<h4 id="unit-tests-1"><a class="header" href="#unit-tests-1">Unit tests</a></h4>
<pre><code>cargo test --lib --all-features
</code></pre>
<h3 id="end-to-end-tests"><a class="header" href="#end-to-end-tests">End-to-end tests</a></h3>
<p>They need to be executed from the <code>e2e_tests</code> folder with a specific set of features describing for
which providers the tests should be run against. You can choose from the following list:
<code>mbed-crypto-provider</code>, <code>pkcs11-provider</code>, <code>tpm-provider</code>, <code>cryptoauthlib-provider</code>, and
<code>trusted-service-provider</code>. <code>all-providers</code> selects them all. In the following sections, the
<code>mbed-crypto-provider</code> will be assumed.</p>
<h4 id="normal-tests"><a class="header" href="#normal-tests">Normal tests</a></h4>
<pre><code>cargo test --features mbed-crypto-provider normal_tests
</code></pre>
<h4 id="persistence-integration-tests"><a class="header" href="#persistence-integration-tests">Persistence integration tests</a></h4>
<p>Those check if the Key Info mapping persist after a shutdown (check the <code>ci.sh</code> script for details
of commands to execute).</p>
<h4 id="stress-tests"><a class="header" href="#stress-tests">Stress tests</a></h4>
<pre><code>cargo test --features mbed-crypto-provider stress_test
</code></pre>
<h4 id="all-providers-end-to-end-tests"><a class="header" href="#all-providers-end-to-end-tests">All providers end-to-end tests.</a></h4>
<p>This expects the Parsec service to include all providers.</p>
<pre><code>cargo test --features all-providers all_providers
</code></pre>
<p>Configuration tests, using all providers (must be run single-threaded):</p>
<pre><code>cargo test --features all-providers config -- --test-threads=1
</code></pre>
<h2 id="fuzz-testing"><a class="header" href="#fuzz-testing">Fuzz testing</a></h2>
<p>Fuzz testing works, at the moment, on a service level, generating random requests and sending them
to be processed. Running the fuzz tests can be done through the <code>fuzz.sh</code> script in the root of the
repository. <code>./fuzz.sh run</code> builds a Docker image where the fuzz tests will run. It then sets up the
environment and initiates the test in the container. The fuzzing engine
(<a href="http://llvm.org/docs/LibFuzzer.html">libFuzzer</a>) works by generating random inputs for a fuzzing
target and then observing the code segments reached using said input. To stop the fuzzer, simply run
<code>./fuzz.sh stop</code>. To view the logs of a currently executing fuzzer, run <code>./fuzz.sh follow</code>. Any
crashes or slow tests, as well as tests that lead to a timeout, are stored in
<code>./fuzz/artifacts/fuzz_service/</code>.</p>
<h2 id="testing-the-tpm-provider-using-the-software-tpm"><a class="header" href="#testing-the-tpm-provider-using-the-software-tpm">Testing the TPM provider using the Software TPM</a></h2>
<p>If you do not have a hardware TPM, or you do not want to use it for tests, you might want to use the
IBM Software TPM. You will need to follow these steps:</p>
<ul>
<li>install the TSS libraries (<a href="https://github.com/tpm2-software/tpm2-tss/blob/master/INSTALL.md">installation
guide</a>). Parsec has been tested
with version 2.3.3.</li>
<li>install the <a href="https://github.com/tpm2-software/tpm2-tools">TPM tools</a>. Parsec has been tested with
version 4.1.</li>
<li>install the <a href="https://sourceforge.net/projects/ibmswtpm2/">Software TPM</a>, run <code>make</code> in the <code>src</code>
directory. It will build the <code>tpm_server</code> executable.</li>
<li>install Parsec with the <code>tpm-provider</code> feature: <code>cargo build --features tpm-provider</code>.</li>
</ul>
<p>Once the required software is installed you can:</p>
<p>Launch the TPM server in the background (in the <code>src</code> folder where the TPM is installed):</p>
<pre><code>$ rm NVChip # this deletes the TPM cache
$ ./tpm_server &amp;
</code></pre>
<p>Use the TPM tools to startup the TPM server and set its owner hierarchy password (the tools need to
be on the <code>PATH</code>):</p>
<pre><code>$ tpm2_startup -c -T mssim
$ tpm2_changeauth -c owner tpm_pass -T mssim
</code></pre>
<p>Start Parsec with the TPM configuration:</p>
<pre><code>$ RUST_LOG=info ./target/debug/parsec -c e2e_tests/provider_cfg/tpm/config.toml
</code></pre>
<p>Which should print a <code>[INFO parsec] Parsec is ready.</code> You can now execute the end-to-end tests using
that provider!</p>
<h2 id="testing-the-pkcs11-provider-using-the-software-hsm"><a class="header" href="#testing-the-pkcs11-provider-using-the-software-hsm">Testing the PKCS11 provider using the Software HSM</a></h2>
<p>If you do not have a hardware HSM, or you do not want to use it for tests, you might want to use the
Software HSM. You will need to follow these steps:</p>
<ul>
<li>install <a href="https://github.com/opendnssec/SoftHSMv2">SoftHSMv2</a>. We use version 2.5.0 for tests in
Parsec.</li>
<li>install Parsec with the <code>pkcs11-provider</code> feature: <code>cargo build --features pkcs11-provider</code>.</li>
</ul>
<p>Create a new token in a new slot.</p>
<pre><code>softhsm2-util --init-token --slot 0 --label &quot;Parsec Tests&quot; --pin 123456 --so-pin 123456
</code></pre>
<p>The slot number assigned will be random and can be found and appended at the end of the
configuration file with the following commands:</p>
<pre><code>SLOT_NUMBER=`softhsm2-util --show-slots | head -n2 | tail -n1 | cut -d &quot; &quot; -f 2`
# Find all TOML files in the directory (except Cargo.toml) and replace the commented slot number with the valid one
find . -name &quot;*toml&quot; -not -name &quot;Cargo.toml&quot; -exec sed -i &quot;s/^# slot_number.*$/slot_number = $SLOT_NUMBER/&quot; {} \;
</code></pre>
<p>Start Parsec with the PKCS11 configuration:</p>
<pre><code>$ RUST_LOG=info ./target/debug/parsec -c e2e_tests/provider_cfg/pkcs11/config.toml
</code></pre>
<p>Which should print a <code>[INFO parsec] Parsec is ready.</code> You can now execute the end-to-end tests using
that provider!</p>
<h2 id="testing-the-trusted-service-provider-using-the-in-process-trusted-services-stack"><a class="header" href="#testing-the-trusted-service-provider-using-the-in-process-trusted-services-stack">Testing the Trusted Service provider using the in-process Trusted Services stack</a></h2>
<p>It is possible to test the Crypto Trusted Service integration through the <code>libts</code> for <code>linux-pc</code>
<a href="https://trusted-services.readthedocs.io/en/integration/deployments/index.html">deployment</a>
available in the project source code. You can find instructions for building and installing the
library
<a href="https://trusted-services.readthedocs.io/en/integration/developer/build-instructions.html">here</a>.
Once the library is installed, no other steps are needed - the whole stack will be housed within the
Parsec service process, similarly to the Mbed Crypto provider.</p>
<p>Start Parsec with the Trusted Service configuration:</p>
<pre><code>$ RUST_LOG=info ./target/debug/parsec -c e2e_tests/provider_cfg/trusted-service/config.toml
</code></pre>
<p>Which should print a <code>[INFO parsec] Parsec is ready.</code> You can now execute the end-to-end tests using
that provider!</p>
<p><strong>NOTE:</strong> The in-process stack uses Mbed Crypto for the crypto implementation, and therefore the
code will be shared with the backend of the Mbed Crypto provider if both are used. Because Mbed
Crypto stores keys on disk, by default in the working directory of the process, creating keys in
both providers in parallel will lead to errors, as one will confuse the keys of the other for its
own.</p>
<p><em>Copyright 2019 Contributors to the Parsec project.</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../parsec_service/configuration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../parsec_service/tests/existing_tests.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../parsec_service/configuration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../parsec_service/tests/existing_tests.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
